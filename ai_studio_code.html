<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XO Game - Ultimate Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #0f0f0f; color: white; overflow: hidden; }
        .winning-line { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.3); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Sound Engine (Web Audio API) ---
        const playSound = (type, enabled) => {
            if (!enabled) return;
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            if (type === 'click') {
                osc.frequency.setValueAtTime(400, now);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(); osc.stop(now + 0.1);
            } else if (type === 'victory') {
                [523, 659, 783, 1046].forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.frequency.setValueAtTime(f, now + (i * 0.1));
                    g.gain.setValueAtTime(0.1, now + (i * 0.1));
                    g.gain.exponentialRampToValueAtTime(0.01, now + (i * 0.1) + 0.3);
                    o.start(now + (i * 0.1)); o.stop(now + (i * 0.1) + 0.3);
                });
            } else if (type === 'draw') {
                osc.frequency.setValueAtTime(150, now);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(); osc.stop(now + 0.5);
            }
        };

        // --- AI Logic ---
        const getBestMove = (board) => {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            
            // 1. ‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏∞
            for (let [a, b, c] of lines) {
                if (board[a] === 'O' && board[b] === 'O' && !board[c]) return c;
                if (board[a] === 'O' && board[c] === 'O' && !board[b]) return b;
                if (board[b] === 'O' && board[c] === 'O' && !board[a]) return a;
            }
            // 2. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô
            for (let [a, b, c] of lines) {
                if (board[a] === 'X' && board[b] === 'X' && !board[c]) return c;
                if (board[a] === 'X' && board[c] === 'X' && !board[b]) return b;
                if (board[b] === 'X' && board[c] === 'X' && !board[a]) return a;
            }
            // 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏≤‡∏á
            if (!board[4]) return 4;
            // 4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏∏‡∏°
            const corners = [0, 2, 6, 8].filter(i => !board[i]);
            if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)];
            // 5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            const available = board.map((v, i) => v === null ? i : null).filter(v => v !== null);
            return available[Math.floor(Math.random() * available.length)];
        };

        // --- Main Component ---
        function App() {
            const [view, setView] = useState('MENU'); // MENU, GAME
            const [mode, setMode] = useState('PVP');
            const [p1Name, setP1Name] = useState('‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1');
            const [p2Name, setP2Name] = useState('‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2');
            const [board, setBoard] = useState(Array(9).fill(null));
            const [isXNext, setIsXNext] = useState(true);
            const [scores, setScores] = useState({ X: 0, O: 0, draw: 0 });
            const [winnerInfo, setWinnerInfo] = useState(null); // { winner, line }
            const [soundEnabled, setSoundEnabled] = useState(true);

            const checkWinner = (squares) => {
                const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
                for (let [a, b, c] of lines) {
                    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
                        return { winner: squares[a], line: [a, b, c] };
                    }
                }
                if (squares.every(s => s !== null)) return { winner: 'DRAW', line: null };
                return null;
            };

            const handleSquareClick = (i) => {
                if (board[i] || winnerInfo) return;

                const newBoard = [...board];
                newBoard[i] = isXNext ? 'X' : 'O';
                setBoard(newBoard);
                playSound('click', soundEnabled);

                const result = checkWinner(newBoard);
                if (result) {
                    setWinnerInfo(result);
                    if (result.winner === 'DRAW') {
                        setScores(s => ({ ...s, draw: s.draw + 1 }));
                        playSound('draw', soundEnabled);
                    } else {
                        setScores(s => ({ ...s, [result.winner]: s[result.winner] + 1 }));
                        playSound('victory', soundEnabled);
                    }
                } else {
                    setIsXNext(!isXNext);
                }
            };

            // AI Turn Effect
            useEffect(() => {
                if (mode === 'AI' && !isXNext && !winnerInfo && view === 'GAME') {
                    const timer = setTimeout(() => {
                        const move = getBestMove(board);
                        if (move !== undefined) handleSquareClick(move);
                    }, 600);
                    return () => clearTimeout(timer);
                }
            }, [isXNext, mode, winnerInfo, view]);

            const resetGame = () => {
                setBoard(Array(9).fill(null));
                setIsXNext(true);
                setWinnerInfo(null);
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    {/* Sound Toggle */}
                    <button 
                        onClick={() => setSoundEnabled(!soundEnabled)}
                        className="fixed top-6 right-6 z-50 bg-[#16213e] p-3 rounded-full border border-[#4a4a6a] hover:bg-[#1a2a4a] transition"
                    >
                        {soundEnabled ? 'üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡∏¥‡∏î' : 'üîà ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏¥‡∏î'}
                    </button>

                    {view === 'MENU' ? (
                        <div className="w-full max-w-md bg-[#16213e] p-8 rounded-3xl shadow-2xl border border-[#4a4a6a] fade-in">
                            <h1 className="text-6xl font-black text-center mb-2 tracking-tighter italic">
                                <span className="text-[#e94560]">X</span>
                                <span className="text-[#00d9ff]">O</span>
                            </h1>
                            <p className="text-center text-gray-400 mb-8 uppercase tracking-widest text-sm">Tic Tac Toe Online</p>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs text-gray-400 ml-1 mb-1 block">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô X</label>
                                    <input 
                                        className="w-full p-4 rounded-xl bg-[#0f0f0f] border border-[#4a4a6a] focus:border-[#e94560] outline-none transition"
                                        value={p1Name}
                                        onChange={(e) => setP1Name(e.target.value)}
                                    />
                                </div>
                                {mode === 'PVP' && (
                                    <div className="fade-in">
                                        <label className="text-xs text-gray-400 ml-1 mb-1 block">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô O</label>
                                        <input 
                                            className="w-full p-4 rounded-xl bg-[#0f0f0f] border border-[#4a4a6a] focus:border-[#00d9ff] outline-none transition"
                                            value={p2Name}
                                            onChange={(e) => setP2Name(e.target.value)}
                                        />
                                    </div>
                                )}

                                <div className="flex gap-3 pt-2">
                                    <button 
                                        onClick={() => {setMode('PVP'); setP2Name('‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2');}}
                                        className={`flex-1 p-4 rounded-xl font-bold transition-all ${mode === 'PVP' ? 'bg-[#e94560] shadow-lg shadow-red-900/20' : 'bg-[#0f0f0f] border border-[#4a4a6a] text-gray-400'}`}
                                    >2 ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
                                    <button 
                                        onClick={() => {setMode('AI'); setP2Name('‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå');}}
                                        className={`flex-1 p-4 rounded-xl font-bold transition-all ${mode === 'AI' ? 'bg-[#e94560] shadow-lg shadow-red-900/20' : 'bg-[#0f0f0f] border border-[#4a4a6a] text-gray-400'}`}
                                    >‡∏™‡∏π‡πâ‡∏Å‡∏±‡∏ö AI</button>
                                </div>

                                <button 
                                    onClick={() => setView('GAME')}
                                    className="w-full p-5 mt-4 bg-white text-black font-black rounded-2xl hover:bg-[#00d9ff] transition-colors active:scale-95 transform"
                                >
                                    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢!
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="w-full max-w-md flex flex-col gap-6 fade-in">
                            {/* Scoreboard */}
                            <div className="flex justify-between items-center bg-[#16213e] p-6 rounded-3xl border border-[#4a4a6a] shadow-xl">
                                <div className={`text-center transition-opacity ${isXNext ? 'opacity-100' : 'opacity-40'}`}>
                                    <p className="text-[#e94560] text-[10px] font-bold uppercase tracking-tighter">Player X</p>
                                    <p className="font-bold truncate w-20">{p1Name}</p>
                                    <p className="text-3xl font-black">{scores.X}</p>
                                </div>
                                <div className="text-center px-4 border-x border-[#4a4a6a]">
                                    <p className="text-gray-500 text-[10px] font-bold uppercase">Draw</p>
                                    <p className="text-2xl font-black mt-4">{scores.draw}</p>
                                </div>
                                <div className={`text-center transition-opacity ${!isXNext ? 'opacity-100' : 'opacity-40'}`}>
                                    <p className="text-[#00d9ff] text-[10px] font-bold uppercase tracking-tighter">Player O</p>
                                    <p className="font-bold truncate w-20">{p2Name}</p>
                                    <p className="text-3xl font-black">{scores.O}</p>
                                </div>
                            </div>

                            {/* Game Board */}
                            <div className="grid grid-cols-3 gap-4 aspect-square">
                                {board.map((val, i) => (
                                    <button
                                        key={i}
                                        onClick={() => handleSquareClick(i)}
                                        disabled={!!val || !!winnerInfo || (mode === 'AI' && !isXNext)}
                                        className={`
                                            h-full w-full rounded-2xl text-5xl font-black flex items-center justify-center
                                            transition-all duration-300 transform 
                                            ${winnerInfo?.line?.includes(i) ? 'winning-line bg-[#e94560] text-white shadow-[0_0_30px_rgba(233,69,96,0.5)]' : 'bg-[#16213e] shadow-lg'}
                                            ${!val && !winnerInfo ? 'hover:scale-[1.02] active:scale-95 hover:bg-[#1f2d4d]' : ''}
                                        `}
                                    >
                                        <span className={`scale-in ${val === 'X' ? 'text-[#e94560]' : 'text-[#00d9ff]'} ${winnerInfo?.line?.includes(i) ? 'text-white' : ''}`}>
                                            {val}
                                        </span>
                                    </button>
                                ))}
                            </div>

                            {/* Status & Controls */}
                            <div className="flex flex-col gap-4">
                                <div className="text-center font-bold text-gray-400 uppercase tracking-widest text-sm">
                                    {winnerInfo ? '‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß' : `‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á: ${isXNext ? p1Name : p2Name}`}
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={resetGame} className="flex-1 p-4 bg-[#4a4a6a] hover:bg-[#5a5a7a] rounded-2xl font-bold transition">‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô</button>
                                    <button onClick={() => setView('MENU')} className="flex-1 p-4 bg-transparent border border-[#4a4a6a] hover:bg-[#16213e] rounded-2xl font-bold transition">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal Result */}
                    {winnerInfo && (
                        <div className="fixed inset-0 bg-black/90 flex items-center justify-center p-6 z-[100] fade-in">
                            <div className="bg-[#16213e] p-12 rounded-[40px] border-2 border-[#00d9ff] text-center shadow-[0_0_80px_rgba(0,217,255,0.2)]">
                                <p className="text-gray-400 uppercase tracking-widest mb-2 font-bold">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>
                                <h2 className="text-5xl font-black mb-8">
                                    {winnerInfo.winner === 'DRAW' ? '‡πÄ‡∏™‡∏°‡∏≠‡∏≠‡∏≠!' : `${winnerInfo.winner === 'X' ? p1Name : p2Name} ‡∏ä‡∏ô‡∏∞!`}
                                </h2>
                                <button 
                                    onClick={resetGame}
                                    className="px-12 py-4 bg-[#00d9ff] text-[#0f0f0f] font-black rounded-2xl hover:scale-110 transition transform shadow-xl shadow-cyan-900/20"
                                >
                                    ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>